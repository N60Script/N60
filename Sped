--================ Services =================
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

--================ Character =================
local character = player.Character or player.CharacterAdded:Wait()
local humanoid = character:WaitForChild("Humanoid")
local hrp = character:WaitForChild("HumanoidRootPart")
local animator = humanoid:WaitForChild("Animator")

--================ Settings =================
local REAL_SPEED = 27        -- السرعة اللي يشوفها السيرفر
local VFLY_SPEED = 35        -- إحساس VFly (خلها نفس REAL)
local NORMAL_SPEED = 16
local DURATION = 7           -- مدة التفعيل

--================ GUI =================
local gui = Instance.new("ScreenGui")
gui.Name = "SpeedFakeGUI"
gui.ResetOnSpawn = false
gui.Parent = player:WaitForChild("PlayerGui")

local main = Instance.new("Frame")
main.Size = UDim2.new(0, 160, 0, 60)
main.Position = UDim2.new(0.4, 0, 0.4, 0)
main.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
main.Active = true
main.Draggable = true
main.Parent = gui

Instance.new("UICorner", main).CornerRadius = UDim.new(0, 14)

local stroke = Instance.new("UIStroke", main)
stroke.Color = Color3.fromRGB(0, 150, 255)
stroke.Thickness = 2

local label = Instance.new("TextLabel")
label.Size = UDim2.new(1, -10, 1, -10)
label.Position = UDim2.new(0, 5, 0, 5)
label.BackgroundColor3 = Color3.fromRGB(15, 15, 15)
label.Text = "SpeedFake"
label.TextColor3 = Color3.fromRGB(0, 180, 255)
label.Font = Enum.Font.GothamBold
label.TextSize = 14
label.Parent = main
Instance.new("UICorner", label).CornerRadius = UDim.new(0, 10)

--================ No Animation =================
local noAnimConn
local function enableNoAnim()
	for _, track in ipairs(animator:GetPlayingAnimationTracks()) do
		track:Stop(0)
	end

	noAnimConn = animator.AnimationPlayed:Connect(function(track)
		track:Stop(0)
	end)

	humanoid.AutoRotate = true
end

local function disableNoAnim()
	if noAnimConn then
		noAnimConn:Disconnect()
		noAnimConn = nil
	end
	humanoid.AutoRotate = true
end

--================ VFly REAL =================
local vflyConn
local function startVFly()
	if vflyConn then vflyConn:Disconnect() end

	vflyConn = RunService.RenderStepped:Connect(function()
		if humanoid.MoveDirection.Magnitude > 0 then
			hrp.AssemblyLinearVelocity = Vector3.new(
				humanoid.MoveDirection.X * VFLY_SPEED,
				hrp.AssemblyLinearVelocity.Y,
				humanoid.MoveDirection.Z * VFLY_SPEED
			)
		else
			hrp.AssemblyLinearVelocity = Vector3.new(
				0,
				hrp.AssemblyLinearVelocity.Y,
				0
			)
		end
	end)
end

local function stopVFly()
	if vflyConn then
		vflyConn:Disconnect()
		vflyConn = nil
	end
end

--================ Enable Speed =================
local active = false
local function enableSpeed()
	if active then return end
	active = true

	label.Text = "تم التفعيل.."
	humanoid.WalkSpeed = REAL_SPEED
	enableNoAnim()
	startVFly()

	task.delay(DURATION, function()
		humanoid.WalkSpeed = NORMAL_SPEED
		disableNoAnim()
		stopVFly()
		label.Text = "SpeedFake"
		active = false
	end)
end

--================ ProximityPrompt Trigger =================
local function hookPrompt(prompt)
	prompt.Triggered:Connect(function(plr)
		if plr == player then
			enableSpeed()
		end
	end)
end

-- الموجودين
for _, obj in ipairs(workspace:GetDescendants()) do
	if obj:IsA("ProximityPrompt") then
		hookPrompt(obj)
	end
end

-- اللي ينضافوا لاحقًا
workspace.DescendantAdded:Connect(function(obj)
	if obj:IsA("ProximityPrompt") then
		hookPrompt(obj)
	end
end)
